title: bzoj3787 Gty的文艺妹子序列 官方题解
date: 2014-12-04 17:14:18
tags: 出的逗比题
---
建议先做[这道题](http://www.lydsy.com/JudgeOnline/problem.php?id=3744)
然后这里是[题解](http://bakser.gitcafe.com/2014/11/16/bzoj3744GTY%E7%9A%84%E5%A6%B9%E5%AD%90%E5%BA%8F%E5%88%97/)
<!--more-->
###我的逗比做法
第一步显然还是分块，设块数为K，块大小为S。
####对于询问
不能跟我原先一样预处理前缀和了，因为涉及到修改。
带修改的前缀和泥萌想到了什么？。。。树状数组对吧。。。
开K个大小为n的树状数组即可。
####对于修改
这大约就是本题的意义了。。。。。。。
按照3744的做法我们预处理了一张大小为K*K的块与块之间的答案表。
然后一个修改会影响到左端点在它之前和右端点在它之后的所有答案，共 $ O(K^2) $ 个，看上去不可做是不是。。。。
我们注意到由于是单点修改，所以影响可以分为两部分。
设修改了x这个位置，会影响到l到r的答案。则一部分是从l到x，另一部分是从x到r，这两部分我们可以分别处理。
对于一个确定的l，即对应二维答案表中的一行。我们发现这次修改只会影响右端点是x所在的块到n所在的块的答案，而且改变的值对于每个l是一定的。（即l到x的影响）
对于一个确定的右端点r，对应表中的一列，影响范围和改变的值也是一定的。
很自然可以想到用支持区间操作的数据结构来维护这次修改，对二维答案表按行按列分别维护，每次 $ O(K) $ 枚举在x前的行和后的列， $ O(logK) $ 进行区间修改即可。总复杂度 $ O(KlogK) $ ，可以承受。
支持区间操作的数据结构。。。。。。窝用的差分树状数组。。。。所以这个题用到的数据结构只有树状数组。。。。。
###被<del>意外</del>卡掉的做法
把K取在 $ {n}^{\frac{1}{3}} $ 左右，修改暴力，总复杂度 $ O({n}^{\frac{5}{3}}logn) $
请允悲。。。。所以说同复杂度的在线莫队大概也够呛了？。。。。
如果有人用其他方法过了请留言Orz